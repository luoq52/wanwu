{"name":"log_anomaly","desc":"日志异常检测","schema":"{\"nodes\":[{\"id\":\"100001\",\"type\":\"1\",\"meta\":{\"position\":{\"y\":27.349999999999994,\"x\":180}},\"data\":{\"nodeMeta\":{\"title\":\"开始\",\"description\":\"工作流的起始节点，用于设定启动工作流需要的信息\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-Start-v2.jpg\"},\"outputs\":[{\"type\":\"string\",\"name\":\"input\",\"required\":true,\"description\":\"日志文本块\"}]}},{\"id\":\"900001\",\"type\":\"2\",\"meta\":{\"position\":{\"x\":1560,\"y\":14.349999999999994}},\"data\":{\"nodeMeta\":{\"title\":\"结束\",\"description\":\"工作流的最终节点，用于返回工作流运行后的结果信息\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-End-v2.jpg\"},\"inputs\":{\"inputParameters\":[{\"name\":\"output\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"source\":\"block-output\",\"blockID\":\"133246\",\"name\":\"output\"},\"rawMeta\":{\"type\":1}}}}],\"terminatePlan\":\"returnVariables\"}}},{\"id\":\"138483\",\"type\":\"5\",\"meta\":{\"position\":{\"x\":640,\"y\":12.999999999999993}},\"data\":{\"nodeMeta\":{\"title\":\"统计错误频率\",\"description\":\"编写代码，处理输入变量来生成返回值\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-Code-v2.jpg\",\"subTitle\":\"代码\",\"mainColor\":\"#00B2B2\"},\"outputs\":[{\"type\":\"integer\",\"name\":\"error_count\"},{\"type\":\"string\",\"name\":\"level_counts\"},{\"type\":\"string\",\"name\":\"log_snippet\"}],\"inputs\":{\"inputParameters\":[{\"name\":\"input\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"source\":\"block-output\",\"blockID\":\"100001\",\"name\":\"input\"},\"rawMeta\":{\"type\":1}}}}],\"settingOnError\":{\"processType\":1,\"timeoutMs\":60000},\"code\":\"import re\\nimport collections\\n\\nasync def main(args: Args) -\u003e Output:\\n    params = args.params\\n    log_text = params['input']          # 原始日志字符串\\n\\n    # 统计ERROR出现次数\\n    error_count = len(re.findall(r'\\\\bERROR\\\\b', log_text, flags=re.IGNORECASE))\\n\\n    # 统计各级别出现次数\\n    level_pattern = re.compile(r'\\\\b(ERROR|WARN|INFO|DEBUG)\\\\b', re.IGNORECASE)\\n    level_counts = collections.Counter(level_pattern.findall(log_text))\\n\\n    ret: Output = {\\n        \\\"error_count\\\": error_count,\\n        \\\"level_counts\\\": dict(level_counts),   # 各级别总数\\n        \\\"log_snippet\\\": log_text[:500]         # 前500字供大模型预览\\n    }\\n    return ret\",\"language\":3}}},{\"id\":\"133246\",\"type\":\"3\",\"meta\":{\"position\":{\"x\":1100,\"y\":0}},\"data\":{\"nodeMeta\":{\"title\":\"生成异常摘要\",\"description\":\"调用大语言模型,使用变量和提示词生成回复\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-LLM-v2.png\",\"subTitle\":\"大模型\",\"mainColor\":\"#5C62FF\"},\"outputs\":[{\"type\":\"string\",\"name\":\"output\"}],\"inputs\":{\"inputParameters\":[{\"name\":\"error_count\",\"input\":{\"type\":\"integer\",\"value\":{\"type\":\"ref\",\"content\":{\"source\":\"block-output\",\"blockID\":\"138483\",\"name\":\"error_count\"},\"rawMeta\":{\"type\":2}}}},{\"name\":\"level_counts\",\"input\":{\"type\":\"integer\",\"value\":{\"type\":\"ref\",\"content\":{\"name\":\"level_counts\",\"source\":\"block-output\",\"blockID\":\"138483\"},\"rawMeta\":{\"type\":2}}}},{\"name\":\"log_snippet\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"name\":\"log_snippet\",\"source\":\"block-output\",\"blockID\":\"138483\"},\"rawMeta\":{\"type\":1}}}}],\"settingOnError\":{\"processType\":1,\"timeoutMs\":180000},\"llmParam\":[{\"name\":\"generationDiversity\",\"input\":{\"type\":\"string\",\"value\":{\"rawMeta\":{\"type\":1},\"type\":\"literal\",\"content\":\"balance\"}}},{\"name\":\"temperature\",\"input\":{\"type\":\"float\",\"value\":{\"type\":\"literal\",\"content\":\"0.8\",\"rawMeta\":{\"type\":4}}}},{\"name\":\"topP\",\"input\":{\"type\":\"float\",\"value\":{\"type\":\"literal\",\"content\":\"1\",\"rawMeta\":{\"type\":4}}}},{\"name\":\"frequencyPenalty\",\"input\":{\"type\":\"float\",\"value\":{\"rawMeta\":{\"type\":4},\"type\":\"literal\",\"content\":\"0\"}}},{\"name\":\"maxTokens\",\"input\":{\"type\":\"integer\",\"value\":{\"type\":\"literal\",\"content\":\"0\",\"rawMeta\":{\"type\":2}}}},{\"name\":\"responseFormat\",\"input\":{\"type\":\"integer\",\"value\":{\"type\":\"literal\",\"content\":\"2\",\"rawMeta\":{\"type\":2}}}},{\"name\":\"prompt\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"literal\",\"content\":\"任务：根据提供的日志片段、ERROR出现次数及各级别统计，用中文输出一段异常摘要，并给出2-3条可能原因或排查建议。\\n\\n日志片段：{{log_snippet}}  \\nERROR出现次数：{{error_count}}  \\n各级别统计：{{level_counts}}\",\"rawMeta\":{\"type\":1}}}},{\"name\":\"enableChatHistory\",\"input\":{\"type\":\"boolean\",\"value\":{\"type\":\"literal\",\"content\":false,\"rawMeta\":{\"type\":3}}}},{\"input\":{\"type\":\"integer\",\"value\":{\"content\":\"3\",\"rawMeta\":{\"type\":2},\"type\":\"literal\"}},\"name\":\"chatHistoryRound\"},{\"name\":\"systemPrompt\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"literal\",\"content\":\"你是日志异常分析专家，分析报告简洁、专业、不超过150字。\",\"rawMeta\":{\"type\":1}}}}]}}}],\"edges\":[{\"sourceNodeID\":\"100001\",\"targetNodeID\":\"138483\"},{\"sourceNodeID\":\"133246\",\"targetNodeID\":\"900001\"},{\"sourceNodeID\":\"138483\",\"targetNodeID\":\"133246\"}],\"versions\":{\"loop\":\"v2\"}}"}
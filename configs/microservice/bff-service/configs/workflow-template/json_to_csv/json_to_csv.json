{"name":"json_to_csv","desc":"JSON 转 CSV","schema":"{\"nodes\":[{\"id\":\"100001\",\"type\":\"1\",\"meta\":{\"position\":{\"x\":180,\"y\":14.350000000000001}},\"data\":{\"nodeMeta\":{\"title\":\"开始\",\"description\":\"工作流的起始节点，用于设定启动工作流需要的信息\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-Start-v2.jpg\"},\"outputs\":[{\"type\":\"string\",\"name\":\"input\",\"required\":true,\"description\":\"json数组格式字符串\"}]}},{\"id\":\"900001\",\"type\":\"2\",\"meta\":{\"position\":{\"x\":1560,\"y\":1.3500000000000014}},\"data\":{\"nodeMeta\":{\"title\":\"结束\",\"description\":\"工作流的最终节点，用于返回工作流运行后的结果信息\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-End-v2.jpg\"},\"inputs\":{\"inputParameters\":[{\"name\":\"output\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"source\":\"block-output\",\"blockID\":\"122024\",\"name\":\"output\"},\"rawMeta\":{\"type\":1}}}}],\"terminatePlan\":\"returnVariables\"}}},{\"id\":\"122024\",\"type\":\"15\",\"meta\":{\"position\":{\"x\":1100,\"y\":0}},\"data\":{\"nodeMeta\":{\"title\":\"添加表头\",\"description\":\"用于处理多个字符串类型变量的格式\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-StrConcat-v2.jpg\",\"subTitle\":\"文本处理\",\"mainColor\":\"#3071F2\"},\"outputs\":[{\"type\":\"string\",\"name\":\"output\",\"required\":true}],\"inputs\":{\"inputParameters\":[{\"name\":\"String1\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"source\":\"block-output\",\"blockID\":\"122185\",\"name\":\"header\"},\"rawMeta\":{\"type\":1}}}},{\"name\":\"String2\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"name\":\"csv\",\"source\":\"block-output\",\"blockID\":\"122185\"},\"rawMeta\":{\"type\":1}}}}],\"method\":\"concat\",\"concatParams\":[{\"name\":\"concatResult\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"literal\",\"content\":\"{{String1}}\\n{{String2}}\",\"rawMeta\":{\"type\":1}}}},{\"name\":\"arrayItemConcatChar\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"literal\",\"content\":\"，\",\"rawMeta\":{\"type\":1}}}},{\"name\":\"allArrayItemConcatChars\",\"input\":{\"type\":\"list\",\"schema\":{\"type\":\"object\",\"schema\":[{\"type\":\"string\",\"name\":\"label\",\"required\":true},{\"required\":true,\"type\":\"string\",\"name\":\"value\"},{\"type\":\"boolean\",\"name\":\"isDefault\",\"required\":true}]},\"value\":{\"type\":\"literal\",\"content\":[{\"label\":\"换行\",\"value\":\"\\n\",\"isDefault\":true},{\"label\":\"制表符\",\"value\":\"\\t\",\"isDefault\":true},{\"label\":\"句号\",\"value\":\"。\",\"isDefault\":true},{\"isDefault\":true,\"label\":\"逗号\",\"value\":\"，\"},{\"isDefault\":true,\"label\":\"分号\",\"value\":\"；\"},{\"label\":\"空格\",\"value\":\" \",\"isDefault\":true}]}}}]}}},{\"id\":\"122185\",\"type\":\"5\",\"meta\":{\"position\":{\"x\":640,\"y\":0}},\"data\":{\"nodeMeta\":{\"title\":\"转换格式\",\"description\":\"编写代码，处理输入变量来生成返回值\",\"icon\":\"http://%E2%80%8B192.168.2.38:8081/api/static/icon/icon-Code-v2.jpg\",\"subTitle\":\"代码\",\"mainColor\":\"#00B2B2\"},\"outputs\":[{\"type\":\"string\",\"name\":\"csv\"},{\"type\":\"string\",\"name\":\"header\"},{\"type\":\"integer\",\"name\":\"rows\"}],\"inputs\":{\"inputParameters\":[{\"name\":\"input\",\"input\":{\"type\":\"string\",\"value\":{\"type\":\"ref\",\"content\":{\"source\":\"block-output\",\"blockID\":\"100001\",\"name\":\"input\"},\"rawMeta\":{\"type\":1}}}}],\"settingOnError\":{\"processType\":1,\"timeoutMs\":60000},\"code\":\"import json\\nimport io\\nimport csv\\n\\nasync def main(args: Args) -\u003e Output:\\n    params = args.params\\n    json_text = params['input']          # 上游传入的 JSON 字符串\\n    data = json.loads(json_text)         # 反序列化\\n\\n    header = list(data[0].keys())        # 仅用于字段顺序\\n    output = io.StringIO()\\n    writer = csv.writer(output)\\n    # 不再写表头\\n    for row in data:\\n        writer.writerow([row[col] for col in header])\\n\\n    csv_content = output.getvalue()\\n    output.close()\\n\\n    ret: Output = {\\n        \\\"csv\\\": csv_content,              # 纯数据行，无表头\\n        \\\"header\\\": \\\",\\\".join(header),      # 单独输出表头说明供下游使用\\n        \\\"rows\\\": len(data)\\n    }\\n    return ret\",\"language\":3}}}],\"edges\":[{\"sourceNodeID\":\"100001\",\"targetNodeID\":\"122185\"},{\"sourceNodeID\":\"122024\",\"targetNodeID\":\"900001\"},{\"sourceNodeID\":\"122185\",\"targetNodeID\":\"122024\"}],\"versions\":{\"loop\":\"v2\"}}"}